<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Strength Comparison Model</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        /* Apply Inter font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for number input arrows in dark mode */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            opacity: 1;
            filter: invert(1) brightness(0.8);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-white">Team Strength Comparison Model</h1>
            <p class="text-lg text-gray-400 mt-2">Enter team data to calculate match prediction and strength.</p>
        </header>

        <!-- Input Data Section -->
        <div class="bg-gray-800 p-6 md:p-8 rounded-2xl shadow-xl mb-8">
            <h2 class="text-2xl font-semibold mb-6 text-white border-b border-gray-700 pb-2">Input Data</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                
                <!-- Home Team Inputs -->
                <div class="space-y-4 p-6 bg-gray-700/50 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-blue-300 mb-4">üè† Home Team</h3>
                    <div>
                        <label for="home_opponents" class="block text-sm font-medium text-gray-300 mb-1">Opponents' Ranks (comma-separated)</label>
                        <input type="text" id="home_opponents" value="10, 15, 18, 20, 16" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="home_points" class="block text-sm font-medium text-gray-300 mb-1">Points</label>
                        <input type="number" id="home_points" value="24" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="home_score" class="block text-sm font-medium text-gray-300 mb-1">Score Avg</label>
                        <input type="number" step="0.01" id="home_score" value="1.55" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="home_score_percentage" class="block text-sm font-medium text-gray-300 mb-1">Score %</label>
                        <input type="number" id="home_score_percentage" value="82" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="home_concede" class="block text-sm font-medium text-gray-300 mb-1">Concede %</label>
                        <input type="number" id="home_concede" value="55" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="home_difficulty" class="block text-sm font-medium text-gray-300 mb-1">Difficulty</label>
                        <input type="number" id="home_difficulty" value="4" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                </div>

                <!-- Away Team Inputs -->
                <div class="space-y-4 p-6 bg-gray-700/50 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold text-green-300 mb-4">‚úàÔ∏è Away Team</h3>
                    <div>
                        <label for="away_opponents" class="block text-sm font-medium text-gray-300 mb-1">Opponents' Ranks (comma-separated)</label>
                        <input type="text" id="away_opponents" value="17, 19, 19, 11, 13" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="away_points" class="block text-sm font-medium text-gray-300 mb-1">Points</label>
                        <input type="number" id="away_points" value="18" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="away_score" class="block text-sm font-medium text-gray-300 mb-1">Score Avg</label>
                        <input type="number" step="0.01" id="away_score" value="1.09" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="away_score_percentage" class="block text-sm font-medium text-gray-300 mb-1">Score %</label>
                        <input type="number" id="away_score_percentage" value="82" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="away_concede" class="block text-sm font-medium text-gray-300 mb-1">Concede %</label>
                        <input type="number" id="away_concede" value="36" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                    <div>
                        <label for="away_difficulty" class="block text-sm font-medium text-gray-300 mb-1">Difficulty</label>
                        <input type="number" id="away_difficulty" value="5" class="w-full bg-gray-800 border-gray-600 rounded-md p-2 text-white focus:ring-blue-500 focus:border-blue-500 shadow-sm">
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculate Button -->
        <div class="text-center mb-8">
            <button id="calculate-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg text-lg transition duration-300 ease-in-out transform hover:scale-105">
                Calculate Prediction
            </button>
        </div>

        <!-- Output Section -->
        <div id="output-section" class="bg-gray-800 p-6 md:p-8 rounded-2xl shadow-xl hidden">
            <h2 class="text-2xl font-semibold mb-6 text-white border-b border-gray-700 pb-2">Prediction Output</h2>
            
            <div class="text-center bg-gray-900 p-6 rounded-lg mb-6">
                <h3 class="text-lg text-gray-400 mb-2">Prediction Result</h3>
                <p id="result" class="text-3xl font-bold text-yellow-400"></p>
            </div>
            
            <div class="text-center bg-gray-900 p-6 rounded-lg mb-6">
                <h3 class="text-lg text-gray-400 mb-2">Prediction Strength</h3>
                <p id="strength" class="text-3xl font-bold text-teal-300"></p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Merit Metrics -->
                <div class="bg-gray-700/50 p-6 rounded-lg shadow-md">
                    <h4 class="text-xl font-semibold text-white mb-4">Merit Metrics</h4>
                    <div class="space-y-2 text-lg">
                        <p><strong>Home Merit:</strong> <span id="home-merit" class="font-mono text-blue-300"></span></p>
                        <p><strong>Away Merit:</strong> <span id="away-merit" class="font-mono text-green-300"></span></p>
                    </div>
                </div>
                <!-- Weight Metrics -->
                <div class="bg-gray-700/50 p-6 rounded-lg shadow-md">
                    <h4 class="text-xl font-semibold text-white mb-4">Weight Metrics</h4>
                    <div class="space-y-2 text-lg">
                        <p><strong>Home Weight:</strong> <span id="home-weight" class="font-mono text-blue-300"></span></p>
                        <p><strong>Away Weight:</strong> <span id="away-weight" class="font-mono text-green-300"></span></p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Error Message Area -->
        <div id="error-message" class="text-center text-red-400 font-medium mt-4"></div>

    </div>

    <script>
        document.getElementById('calculate-btn').addEventListener('click', calculatePrediction);

        function calculatePrediction() {
            try {
                // --- Get and Parse Input Data ---
                
                // Helper function to parse opponent lists
                const parseOpponents = (id) => {
                    const str = document.getElementById(id).value;
                    return str.split(',')
                              .map(item => parseFloat(item.trim()))
                              .filter(val => !isNaN(val)); // Filter out invalid numbers
                };

                // Helper function to sum an array
                const sum = (arr) => arr.reduce((a, b) => a + b, 0);

                // Helper function to get a number value
                const getNum = (id) => parseFloat(document.getElementById(id).value);

                // Home team data
                const home_opponents_list = parseOpponents('home_opponents');
                const home_points = getNum('home_points');
                const home_score = getNum('home_score');
                const home_score_percentage = getNum('home_score_percentage');
                const home_concede = getNum('home_concede');
                const home_difficulty = getNum('home_difficulty');

                // Away team data
                const away_opponents_list = parseOpponents('away_opponents');
                const away_points = getNum('away_points');
                const away_score = getNum('away_score');
                const away_score_percentage = getNum('away_score_percentage');
                const away_concede = getNum('away_concede');
                const away_difficulty = getNum('away_difficulty');

                // Check for invalid inputs
                if (home_opponents_list.length === 0 || away_opponents_list.length === 0) {
                    throw new Error("Opponent list is empty or invalid. Please enter comma-separated numbers.");
                }
                if ([home_points, home_score, home_score_percentage, home_concede, home_difficulty, away_points, away_score, away_score_percentage, away_concede, away_difficulty].some(isNaN)) {
                    throw new Error("All input fields must contain valid numbers.");
                }
                if (home_points === 0 || away_points === 0 || (100 - away_concede) === 0 || (100 - home_concede) === 0 || home_score_percentage === 0 || away_score_percentage === 0 || home_score === 0 || away_score === 0) {
                    throw new Error("Division by zero error. Check points, concede %, score %, or score values.");
                }

                // --- Derived Metrics ---
                const home_total = sum(home_opponents_list);
                const away_total = sum(away_opponents_list);
                
                const home_merit = home_score_percentage / (100 - away_concede);
                const away_merit = away_score_percentage / (100 - home_concede);
                
                const home_weight = (home_total / home_points) * home_score;
                const away_weight = (away_total / away_points) * away_score;

                // --- Match Prediction Logic ---
                let result = "";
                if (
                    home_weight > away_weight &&
                    home_merit > away_merit &&
                    home_difficulty >= away_difficulty &&
                    home_points > away_points
                ) {
                    result = "HOME WIN";
                } else if (
                    away_weight > home_weight &&
                    away_merit > home_merit &&
                    away_difficulty >= home_difficulty &&
                    away_points > home_points
                ) {
                    result = "AWAY WIN";
                } else if (
                    home_weight > away_weight &&
                    home_merit > away_merit &&
                    home_difficulty >= away_difficulty
                ) {
                    result = "HOME DRAW";
                } else if (
                    away_weight > home_weight &&
                    home_merit < away_merit &&
                    away_difficulty >= home_difficulty
                ) {
                    result = "AWAY DRAW";
                } else {
                    result = "AVOID";
                }

                // --- Strength Analysis ---
                const new_home = ((100 - away_concede) * home_score) / home_score_percentage;
                const new_away = ((100 - home_concede) * away_score) / away_score_percentage;
                
                const new_home_diff = ((new_home - home_score) / home_score) * 100;
                const new_away_diff = ((new_away - away_score) / away_score) * 100;
                
                const home_diff = ((home_score - away_score) / away_score) * 100;
                const away_diff = ((away_score - home_score) / home_score) * 100;

                let strength = "";
                let per = "-";

                if (home_weight > away_weight && home_merit > away_merit && home_diff * 0.3 > new_away_diff) {
                    strength = "HOME";
                    per = new_away_diff.toFixed(1);
                } else if (home_weight > away_weight && home_merit > away_merit && home_diff * 0.6 > new_away_diff) {
                    strength = "HOME-draw";
                    per = new_away_diff.toFixed(1);
                } else if (home_weight < away_weight && home_merit < away_merit && away_diff * 0.3 > new_home_diff) {
                    strength = "AWAY";
                    per = new_home_diff.toFixed(1);
                } else if (home_weight < away_weight && home_merit < away_merit && away_diff * 0.6 > new_home_diff) {
                    strength = "AWAY-draw";
                    per = new_home_diff.toFixed(1);
                } else {
                    strength = "NULL";
                }

                // --- Display Output ---
                document.getElementById('output-section').classList.remove('hidden');
                document.getElementById('error-message').textContent = ""; // Clear any old errors

                document.getElementById('result').textContent = `üèüÔ∏è ${result}`;
                document.getElementById('strength').textContent = `${strength} ( ${per} )`;
                
                document.getElementById('home-merit').textContent = home_merit.toFixed(3);
                document.getElementById('away-merit').textContent = away_merit.toFixed(3);
                
                document.getElementById('home-weight').textContent = home_weight.toFixed(3);
                document.getElementById('away-weight').textContent = away_weight.toFixed(3);

            } catch (error) {
                // Display error message
                document.getElementById('error-message').textContent = `Error: ${error.message}`;
                document.getElementById('output-section').classList.add('hidden'); // Hide results
            }
        }

        // Run calculation on page load with default values
        window.onload = calculatePrediction;
    </script>
</body>
</html>
