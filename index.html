<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Football Prediction Evaluator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Set base font family -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for result feedback */
        .reason-item.positive {
            color: #16a34a; /* green-600 */
        }
        .reason-item.negative {
            color: #dc2626; /* red-600 */
        }
        .reason-item.neutral {
            color: #6b7280; /* gray-500 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg w-full max-w-2xl">
        
        <!-- Header -->
        <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-2">Smart Football Prediction Evaluator</h1>
        <p class="text-center text-gray-500 mb-6">Rate a prediction based on team stats, odds, and realism.</p>

        <!-- Main Form -->
        <form id="predictionForm" class="space-y-6">

            <!-- Section 1: Team Stats -->
            <div>
                <h2 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Team Stats</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Home Team -->
                    <div class="space-y-4 p-4 bg-gray-50 rounded-lg border">
                        <h3 class="font-medium text-lg text-center">Home Team</h3>
                        <div>
                            <label for="home_avg_score" class="block text-sm font-medium text-gray-700 mb-1">Avg. Score</label>
                            <input type="number" step="0.01" id="home_avg_score" value="2.75" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="home_avg_conceded" class="block text-sm font-medium text-gray-700 mb-1">Avg. Conceded</label>
                            <input type="number" step="0.01" id="home_avg_conceded" value="0.83" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <!-- Away Team -->
                    <div class="space-y-4 p-4 bg-gray-50 rounded-lg border">
                        <h3 class="font-medium text-lg text-center">Away Team</h3>
                        <div>
                            <label for="away_avg_score" class="block text-sm font-medium text-gray-700 mb-1">Avg. Score</label>
                            <input type="number" step="0.01" id="away_avg_score" value="1.8" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="away_avg_conceded" class="block text-sm font-medium text-gray-700 mb-1">Avg. Conceded</label>
                            <input type="number" step="0.01" id="away_avg_conceded" value="1.2" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Prediction Details -->
            <div>
                <h2 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Prediction Details</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label for="prediction" class="block text-sm font-medium text-gray-700 mb-1">Prediction Text</label>
                        <input type="text" id="prediction" value="Away Win and Over 2.5" placeholder="e.g., Home Win and BTTS" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="odds" class="block text-sm font-medium text-gray-700 mb-1">Odds</label>
                        <input type="number" step="0.01" id="odds" value="2.10" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="stake" class="block text-sm font-medium text-gray-700 mb-1">Stake (Units)</label>
                        <input type="number" step="1" id="stake" value="12" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <div class="mt-4">
                     <label for="correct_score" class="block text-sm font-medium text-gray-700 mb-1">Correct Score (H:A)</label>
                     <input type="text" id="correct_score" value="1:4" placeholder="e.g., 2:1" class="w-full max-w-xs px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>
            
            <!-- Submit Button -->
            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-200 ease-in-out">
                Rate Prediction
            </button>
        </form>

        <!-- Result Section -->
        <div id="resultSection" class="mt-8 border-t pt-6" style="display: none;">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Evaluation Result</h2>
            
            <!-- Confidence Bar -->
            <div>
                <div class="flex justify-between mb-1">
                    <span class="text-base font-medium text-blue-700">Confidence</span>
                    <span id="confidenceText" class="text-sm font-medium text-blue-700">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4">
                    <div id="confidenceBar" class="bg-blue-600 h-4 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                </div>
            </div>

            <!-- Verdict -->
            <div class="mt-4">
                <span class="block text-sm font-medium text-gray-500">Verdict</span>
                <span id="verdictText" class="text-3xl font-bold text-gray-900"></span>
            </div>

            <!-- Reasoning -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Reasoning</h3>
                <ul id="reasoningList" class="list-disc list-inside space-y-1">
                    <!-- JS will populate this -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        // --- Main Prediction Logic (Ported from Python) ---

        function rate_prediction(home_avg_score, home_avg_conceded, away_avg_score, away_avg_conceded,
                                 prediction, odds, correct_score, stake) {
            
            let score = 50; // start from a neutral score
            let reasoning = []; // store explanations for each adjustment

            // Helper to add reasoning with a type for styling
            function addReason(text, type) {
                reasoning.push({ text, type });
            }

            // 1. Match outcome logic
            if (prediction.includes("Home")) {
                if (home_avg_score > away_avg_conceded && home_avg_score > away_avg_score) {
                    score += 10;
                    addReason("Home attack stronger than away defense.", "positive");
                } else {
                    score -= 10;
                    addReason("Home attack not strong enough for a confident home win.", "negative");
                }
            } else if (prediction.includes("Away")) {
                if (away_avg_score > home_avg_conceded && away_avg_score >= home_avg_score) {
                    score += 10;
                    addReason("Away attack stronger than home defense.", "positive");
                } else {
                    score -= 10;
                    addReason("Away attack not strong enough for a confident away win.", "negative");
                }
            }

            // 2. Over 2.5 goals logic
            if (prediction.includes("Over 2.5")) {
                let avg_total = (home_avg_score + away_avg_score) / 2;
                if (avg_total >= 2.5) {
                    score += 10;
                    addReason("Goal averages support Over 2.5.", "positive");
                } else {
                    score -= 10;
                    addReason("Averages too low for Over 2.5.", "negative");
                }
            }

            // 3. Both Teams To Score logic
            if (prediction.includes("Both Teams To Score") || prediction.includes("BTTS")) {
                if (home_avg_score >= 1 && away_avg_score >= 1) {
                    score += 10;
                    addReason("Both teams average more than 1 goal per game.", "positive");
                } else {
                    score -= 10;
                    addReason("One team rarely scores; BTTS less likely.", "negative");
                }
            }

            // 4. Odds adjustment
            if (odds > 3) {
                score -= 8;
                addReason("High odds indicate risky prediction.", "negative");
            } else if (odds >= 2 && odds <= 3) {
                score -= 3;
                addReason("Moderate odds: medium risk.", "neutral");
            } else if (odds < 2) {
                score += 5;
                addReason("Low odds suggest safer outcome.", "positive");
            }

            // 5. Stake influence
            if (stake >= 10) {
                score += 3;
                addReason("Higher stake indicates confidence.", "positive");
            } else if (stake <= 5) {
                score -= 3;
                addReason("Low stake suggests low confidence.", "negative");
            }

            // 6. Correct score realism check
            try {
                const [h, a] = correct_score.split(":").map(Number);
                if (isNaN(h) || isNaN(a)) throw new Error("Invalid format");

                if (Math.abs(h - home_avg_score) < 1 && Math.abs(a - away_avg_score) < 1) {
                    score += 4;
                    addReason("Correct score prediction seems realistic.", "positive");
                } else {
                    score -= 4;
                    addReason("Correct score looks unrealistic.", "negative");
                }
            } catch (e) {
                addReason("Correct score format issue (use H:A).", "neutral");
            }

            // 7. Clamp score between 0 and 100
            score = Math.max(0, Math.min(100, score));

            // 8. Generate final verdict
            let verdict = "";
            if (score >= 80) {
                verdict = "Excellent Prediction";
            } else if (score >= 65) {
                verdict = "Good Prediction";
            } else if (score >= 45) {
                verdict = "Average Prediction";
            } else {
                verdict = "Weak Prediction";
            }

            // 9. Return structured output
            return {
                confidence: score,
                verdict: verdict,
                reasoning: reasoning
            };
        }

        // --- Event Listener to connect form to logic ---
        
        document.getElementById("predictionForm").addEventListener("submit", function(event) {
            event.preventDefault(); // Prevent the form from submitting traditionally

            // Get values from the form
            const home_avg_score = parseFloat(document.getElementById("home_avg_score").value) || 0;
            const home_avg_conceded = parseFloat(document.getElementById("home_avg_conceded").value) || 0;
            const away_avg_score = parseFloat(document.getElementById("away_avg_score").value) || 0;
            const away_avg_conceded = parseFloat(document.getElementById("away_avg_conceded").value) || 0;
            const prediction = document.getElementById("prediction").value;
            const odds = parseFloat(document.getElementById("odds").value) || 0;
            const correct_score = document.getElementById("correct_score").value;
            const stake = parseFloat(document.getElementById("stake").value) || 0;

            // Run the evaluation
            const result = rate_prediction(
                home_avg_score, home_avg_conceded,
                away_avg_score, away_avg_conceded,
                prediction, odds, correct_score, stake
            );

            // --- Display the results ---

            // Get result elements
            const resultSection = document.getElementById("resultSection");
            const confidenceText = document.getElementById("confidenceText");
            const confidenceBar = document.getElementById("confidenceBar");
            const verdictText = document.getElementById("verdictText");
            const reasoningList = document.getElementById("reasoningList");

            // Update confidence
            const confidence = result.confidence;
            confidenceText.textContent = `${confidence}%`;
            confidenceBar.style.width = `${confidence}%`;
            
            // Update confidence bar color based on score
            confidenceBar.classList.remove("bg-red-600", "bg-yellow-500", "bg-green-600", "bg-blue-600"); // Clear old colors
            if (confidence < 45) {
                confidenceBar.classList.add("bg-red-600");
            } else if (confidence < 65) {
                confidenceBar.classList.add("bg-yellow-500");
            } else if (confidence < 80) {
                confidenceBar.classList.add("bg-green-600");
            } else {
                confidenceBar.classList.add("bg-blue-600");
            }

            // Update verdict
            verdictText.textContent = result.verdict;

            // Update reasoning
            reasoningList.innerHTML = ""; // Clear old reasoning
            if (result.reasoning.length > 0) {
                result.reasoning.forEach(item => {
                    const li = document.createElement("li");
                    li.textContent = item.text;
                    // Add class based on reason type
                    if (item.type === "positive") {
                        li.className = "reason-item positive";
                    } else if (item.type === "negative") {
                        li.className = "reason-item negative";
                    } else {
                        li.className = "reason-item neutral";
                    }
                    reasoningList.appendChild(li);
                });
            } else {
                reasoningList.innerHTML = "<li class='text-gray-500'>No specific reasoning triggered. Base score applied.</li>";
            }
            
            // Show the result section
            resultSection.style.display = "block";
            // Scroll to results on small screens
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'end' });
        });

    </script>
</body>
</html>
