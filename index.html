<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football Match Predictor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: #2a5298;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .predict-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .predict-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }

        .predict-btn:active {
            transform: translateY(0);
        }

        .results {
            display: none;
        }

        .outcome-card {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .outcome-home { background: linear-gradient(135deg, #007bff, #0056b3); }
        .outcome-draw { background: linear-gradient(135deg, #ffc107, #e0a800); }
        .outcome-away { background: linear-gradient(135deg, #dc3545, #c82333); }

        .prob-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .prob-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
        }

        .prob-card h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .prob-card .percentage {
            font-size: 2rem;
            font-weight: bold;
            color: #2a5298;
        }

        .expected-goals {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .goals-card {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
            border-radius: 10px;
        }

        .quality-scores {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .quality-card {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #6f42c1, #5a32a3);
            color: white;
            border-radius: 10px;
        }

        .model-breakdown {
            margin-top: 20px;
        }

        .model-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #2a5298;
        }

        .model-item h5 {
            color: #2a5298;
            margin-bottom: 8px;
            text-transform: capitalize;
        }

        .model-probs {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .advice-section {
            background: linear-gradient(135deg, #fd7e14, #e8590c);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 20px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .prob-grid {
                grid-template-columns: 1fr;
            }

            .expected-goals,
            .quality-scores {
                grid-template-columns: 1fr;
            }

            .model-probs {
                flex-direction: column;
                gap: 5px;
            }

            .comparison-table {
                font-size: 0.8rem;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2a5298;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öΩ Football Match Predictor</h1>
            <p>Advanced AI-powered match outcome prediction</p>
        </div>

        <div class="card">
            <form id="matchForm">
                <div class="form-section">
                    <h3>üè† Home Team Statistics</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="homeAvgScore">Average Goals Scored</label>
                            <input type="number" id="homeAvgScore" step="0.01" value="1.43" required>
                        </div>
                        <div class="form-group">
                            <label for="homeAvgConceded">Average Goals Conceded</label>
                            <input type="number" id="homeAvgConceded" step="0.01" value="0.91" required>
                        </div>
                        <div class="form-group">
                            <label for="homeScorePercentage">Scoring Percentage (%)</label>
                            <input type="number" id="homeScorePercentage" min="0" max="100" value="65" required>
                        </div>
                        <div class="form-group">
                            <label for="homeCleansheet">Clean Sheet Percentage (%)</label>
                            <input type="number" id="homeCleansheet" min="0" max="100" value="35" required>
                        </div>
                        <div class="form-group">
                            <label for="homeDifficulty">Fixture Difficulty (1-5)</label>
                            <select id="homeDifficulty" required>
                                <option value="1">1 - Very Easy</option>
                                <option value="2">2 - Easy</option>
                                <option value="3">3 - Medium</option>
                                <option value="4" selected>4 - Hard</option>
                                <option value="5">5 - Very Hard</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="homeOdds">Betting Odds</label>
                            <input type="number" id="homeOdds" step="0.01" value="2.2" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>‚úàÔ∏è Away Team Statistics</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="awayAvgScore">Average Goals Scored</label>
                            <input type="number" id="awayAvgScore" step="0.01" value="1.22" required>
                        </div>
                        <div class="form-group">
                            <label for="awayAvgConceded">Average Goals Conceded</label>
                            <input type="number" id="awayAvgConceded" step="0.01" value="1.39" required>
                        </div>
                        <div class="form-group">
                            <label for="awayScorePercentage">Scoring Percentage (%)</label>
                            <input type="number" id="awayScorePercentage" min="0" max="100" value="65" required>
                        </div>
                        <div class="form-group">
                            <label for="awayCleansheet">Clean Sheet Percentage (%)</label>
                            <input type="number" id="awayCleansheet" min="0" max="100" value="4" required>
                        </div>
                        <div class="form-group">
                            <label for="awayDifficulty">Fixture Difficulty (1-5)</label>
                            <select id="awayDifficulty" required>
                                <option value="1" selected>1 - Very Easy</option>
                                <option value="2">2 - Easy</option>
                                <option value="3">3 - Medium</option>
                                <option value="4">4 - Hard</option>
                                <option value="5">5 - Very Hard</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="awayOdds">Betting Odds</label>
                            <input type="number" id="awayOdds" step="0.01" value="3.1" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üéØ Match Odds</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="drawOdds">Draw Odds</label>
                            <input type="number" id="drawOdds" step="0.01" value="3.4" required>
                        </div>
                    </div>
                </div>

                <button type="submit" class="predict-btn">üîÆ Predict Match Outcome</button>
            </form>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Analyzing match data...</p>
            </div>
        </div>

        <div id="results" class="results">
            <div class="card">
                <div id="outcomeCard" class="outcome-card">
                    <div id="outcomeText"></div>
                    <div id="confidenceText"></div>
                </div>

                <h3 style="color: #2a5298; margin-bottom: 15px;">üìä Final Probabilities</h3>
                <div class="prob-grid">
                    <div class="prob-card">
                        <h4>Home Win</h4>
                        <div class="percentage" id="homeWinProb">0%</div>
                    </div>
                    <div class="prob-card">
                        <h4>Draw</h4>
                        <div class="percentage" id="drawProb">0%</div>
                    </div>
                    <div class="prob-card">
                        <h4>Away Win</h4>
                        <div class="percentage" id="awayWinProb">0%</div>
                    </div>
                </div>

                <h3 style="color: #2a5298; margin-bottom: 15px;">‚öΩ Expected Goals</h3>
                <div class="expected-goals">
                    <div class="goals-card">
                        <h4>Home Team</h4>
                        <div style="font-size: 2rem; font-weight: bold;" id="homeExpectedGoals">0.00</div>
                    </div>
                    <div class="goals-card">
                        <h4>Away Team</h4>
                        <div style="font-size: 2rem; font-weight: bold;" id="awayExpectedGoals">0.00</div>
                    </div>
                </div>

                <h3 style="color: #2a5298; margin-bottom: 15px;">üèÜ Team Quality Scores</h3>
                <div class="quality-scores">
                    <div class="quality-card">
                        <h4>Home Team</h4>
                        <div style="font-size: 2rem; font-weight: bold;" id="homeQuality">0.000</div>
                    </div>
                    <div class="quality-card">
                        <h4>Away Team</h4>
                        <div style="font-size: 2rem; font-weight: bold;" id="awayQuality">0.000</div>
                    </div>
                </div>

                <h3 style="color: #2a5298; margin-bottom: 15px;">üîç Model Breakdown</h3>
                <div id="modelBreakdown" class="model-breakdown"></div>

                <h3 style="color: #2a5298; margin-bottom: 15px;">üß† Advanced Analysis</h3>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Outcome</th>
                            <th>Final Prob</th>
                            <th>Composite Prob</th>
                            <th>Difference</th>
                        </tr>
                    </thead>
                    <tbody id="comparisonTable">
                    </tbody>
                </table>

                <div id="adviceSection" class="advice-section"></div>
            </div>
        </div>
    </div>

    <script>
        // Enums and Classes
        const Outcome = {
            HOME_WIN: "Home Win",
            DRAW: "Draw",
            AWAY_WIN: "Away Win"
        };

        class MatchData {
            constructor(data) {
                this.homeAvgScore = data.homeAvgScore;
                this.awayAvgScore = data.awayAvgScore;
                this.homeAvgConceded = data.homeAvgConceded;
                this.awayAvgConceded = data.awayAvgConceded;
                this.homeScorePercentage = data.homeScorePercentage;
                this.awayScorePercentage = data.awayScorePercentage;
                this.homeCleansheet = data.homeCleansheet;
                this.awayCleansheet = data.awayCleansheet;
                this.homeDifficulty = data.homeDifficulty;
                this.awayDifficulty = data.awayDifficulty;
                this.homeOdds = data.homeOdds;
                this.drawOdds = data.drawOdds;
                this.awayOdds = data.awayOdds;
            }
        }

        class FootballPredictor {
            constructor() {
                this.weights = {
                    poisson: 0.25,
                    formBased: 0.20,
                    defensiveStrength: 0.15,
                    marketSentiment: 0.20,
                    compositeRating: 0.20
                };
            }

            factorial(n) {
                if (n <= 1) return 1;
                let result = 1;
                for (let i = 2; i <= n; i++) {
                    result *= i;
                }
                return result;
            }

            poissonProb(k, lam) {
                if (lam <= 0) {
                    return k === 0 ? 1.0 : 0.0;
                }
                return (Math.pow(lam, k) * Math.exp(-lam)) / this.factorial(k);
            }

            calculatePoissonProbabilities(matchData) {
                // Adjust scores based on opposition difficulty
                const homeAttackStrength = matchData.homeAvgScore * (6 - matchData.awayDifficulty) / 5;
                const awayAttackStrength = matchData.awayAvgScore * (6 - matchData.homeDifficulty) / 5;

                const homeDefenseStrength = matchData.homeAvgConceded * (matchData.awayDifficulty / 5);
                const awayDefenseStrength = matchData.awayAvgConceded * (matchData.homeDifficulty / 5);

                // Expected goals calculation
                const homeExpectedGoals = (homeAttackStrength + awayDefenseStrength) / 2;
                const awayExpectedGoals = (awayAttackStrength + homeDefenseStrength) / 2;

                // Poisson probabilities for different score outcomes
                const maxGoals = 6;
                const probMatrix = [];
                for (let i = 0; i <= maxGoals; i++) {
                    probMatrix[i] = [];
                    for (let j = 0; j <= maxGoals; j++) {
                        const probH = this.poissonProb(i, homeExpectedGoals);
                        const probA = this.poissonProb(j, awayExpectedGoals);
                        probMatrix[i][j] = probH * probA;
                    }
                }

                // Calculate outcome probabilities
                let homeWin = 0, draw = 0, awayWin = 0;

                for (let h = 0; h <= maxGoals; h++) {
                    for (let a = 0; a <= maxGoals; a++) {
                        if (h > a) homeWin += probMatrix[h][a];
                        else if (h === a) draw += probMatrix[h][a];
                        else awayWin += probMatrix[h][a];
                    }
                }

                return {
                    homeWin,
                    draw,
                    awayWin,
                    expectedGoals: { home: homeExpectedGoals, away: awayExpectedGoals }
                };
            }

            calculateFormBasedPrediction(matchData) {
                // Normalize scoring percentages
                const homeForm = matchData.homeScorePercentage / 100.0;
                const awayForm = matchData.awayScorePercentage / 100.0;

                // Calculate relative form advantage
                const totalForm = homeForm + awayForm;
                let homeFormAdvantage, awayFormAdvantage;

                if (totalForm > 0) {
                    homeFormAdvantage = homeForm / totalForm;
                    awayFormAdvantage = awayForm / totalForm;
                } else {
                    homeFormAdvantage = awayFormAdvantage = 0.5;
                }

                // Adjust for home advantage
                const homeAdvantageBoost = 0.07;
                homeFormAdvantage += homeAdvantageBoost;

                // Normalize to ensure probabilities sum to 1
                const formSum = homeFormAdvantage + awayFormAdvantage;
                homeFormAdvantage /= formSum;
                awayFormAdvantage /= formSum;

                // Calculate draw probability
                const formDifference = Math.abs(homeFormAdvantage - awayFormAdvantage);
                let drawProb = 0.35 - (formDifference * 0.2);
                drawProb = Math.max(0.15, Math.min(0.45, drawProb));

                // Redistribute remaining probability
                const remainingProb = 1.0 - drawProb;
                const homeWinProb = homeFormAdvantage * remainingProb;
                const awayWinProb = awayFormAdvantage * remainingProb;

                return {
                    homeWin: homeWinProb,
                    draw: drawProb,
                    awayWin: awayWinProb
                };
            }

            calculateDefensiveStrengthModel(matchData) {
                // Calculate defensive ratings
                const homeDefenseRating = (matchData.homeCleansheet / 100.0) * (1 / Math.max(0.1, matchData.homeAvgConceded));
                const awayDefenseRating = (matchData.awayCleansheet / 100.0) * (1 / Math.max(0.1, matchData.awayAvgConceded));

                // Calculate attacking threat against defense
                const homeAttackVsAwayDefense = matchData.homeAvgScore / Math.max(0.1, matchData.awayAvgConceded);
                const awayAttackVsHomeDefense = matchData.awayAvgScore / Math.max(0.1, matchData.homeAvgConceded);

                // Normalize attack ratios
                const totalAttackRatio = homeAttackVsAwayDefense + awayAttackVsHomeDefense;
                let homeAttackNorm, awayAttackNorm;

                if (totalAttackRatio > 0) {
                    homeAttackNorm = homeAttackVsAwayDefense / totalAttackRatio;
                    awayAttackNorm = awayAttackVsHomeDefense / totalAttackRatio;
                } else {
                    homeAttackNorm = awayAttackNorm = 0.5;
                }

                // Strong defenses increase draw probability
                const avgDefenseStrength = (homeDefenseRating + awayDefenseRating) / 2;
                const drawBoost = Math.min(0.15, avgDefenseStrength * 0.3);

                const baseDraw = 0.25 + drawBoost;
                const remainingProb = 1.0 - baseDraw;

                return {
                    homeWin: homeAttackNorm * remainingProb,
                    draw: baseDraw,
                    awayWin: awayAttackNorm * remainingProb
                };
            }

            calculateMarketSentimentModel(matchData) {
                // Convert odds to implied probabilities
                const homeImplied = 1 / matchData.homeOdds;
                const drawImplied = 1 / matchData.drawOdds;
                const awayImplied = 1 / matchData.awayOdds;

                // Remove overround (bookmaker margin)
                const totalImplied = homeImplied + drawImplied + awayImplied;

                // Normalize to true probabilities
                return {
                    homeWin: homeImplied / totalImplied,
                    draw: drawImplied / totalImplied,
                    awayWin: awayImplied / totalImplied
                };
            }

            calculateCompositeRatingModel(matchData) {
                // Calculate team quality scores
                const homeQuality = (
                    matchData.homeAvgScore * 0.3 +
                    (1 / Math.max(0.1, matchData.homeAvgConceded)) * 0.2 +
                    (matchData.homeScorePercentage / 100) * 0.25 +
                    (matchData.homeCleansheet / 100) * 0.15 +
                    ((6 - matchData.homeDifficulty) / 5) * 0.1
                );

                const awayQuality = (
                    matchData.awayAvgScore * 0.3 +
                    (1 / Math.max(0.1, matchData.awayAvgConceded)) * 0.2 +
                    (matchData.awayScorePercentage / 100) * 0.25 +
                    (matchData.awayCleansheet / 100) * 0.15 +
                    ((6 - matchData.awayDifficulty) / 5) * 0.1
                );

                // Quality difference analysis
                const qualityDiff = homeQuality - awayQuality;
                const qualitySum = homeQuality + awayQuality;

                // Sigmoid transformation for probability
                let homeBaseProb, awayBaseProb;
                if (qualitySum > 0) {
                    homeBaseProb = 1 / (1 + Math.exp(-qualityDiff * 3));
                    awayBaseProb = 1 - homeBaseProb;
                } else {
                    homeBaseProb = awayBaseProb = 0.5;
                }

                // Adjust for match context
                const contextFactor = Math.sqrt(homeQuality * awayQuality);
                let drawProb = 0.2 + (contextFactor * 0.15);
                drawProb = Math.min(0.4, drawProb);

                // Redistribute
                const remaining = 1.0 - drawProb;
                const homeWinProb = homeBaseProb * remaining;
                const awayWinProb = awayBaseProb * remaining;

                return {
                    homeWin: homeWinProb,
                    draw: drawProb,
                    awayWin: awayWinProb,
                    homeQuality,
                    awayQuality
                };
            }

            predictMatch(matchData) {
                // Calculate predictions from all models
                const poissonPred = this.calculatePoissonProbabilities(matchData);
                const formPred = this.calculateFormBasedPrediction(matchData);
                const defensePred = this.calculateDefensiveStrengthModel(matchData);
                const marketPred = this.calculateMarketSentimentModel(matchData);
                const compositePred = this.calculateCompositeRatingModel(matchData);

                // Ensemble prediction using weighted average
                let finalHome = (
                    poissonPred.homeWin * this.weights.poisson +
                    formPred.homeWin * this.weights.formBased +
                    defensePred.homeWin * this.weights.defensiveStrength +
                    marketPred.homeWin * this.weights.marketSentiment +
                    compositePred.homeWin * this.weights.compositeRating
                );

                let finalDraw = (
                    poissonPred.draw * this.weights.poisson +
                    formPred.draw * this.weights.formBased +
                    defensePred.draw * this.weights.defensiveStrength +
                    marketPred.draw * this.weights.marketSentiment +
                    compositePred.draw * this.weights.compositeRating
                );

                let finalAway = (
                    poissonPred.awayWin * this.weights.poisson +
                    formPred.awayWin * this.weights.formBased +
                    defensePred.awayWin * this.weights.defensiveStrength +
                    marketPred.awayWin * this.weights.marketSentiment +
                    compositePred.awayWin * this.weights.compositeRating
                );

                // Normalize to ensure probabilities sum to 1
                const total = finalHome + finalDraw + finalAway;
                finalHome /= total;
                finalDraw /= total;
                finalAway /= total;

                // Determine most likely outcome
                const maxProb = Math.max(finalHome, finalDraw, finalAway);
                let predictedOutcome;
                if (maxProb === finalHome) {
                    predictedOutcome = Outcome.HOME_WIN;
                } else if (maxProb === finalDraw) {
                    predictedOutcome = Outcome.DRAW;
                } else {
                    predictedOutcome = Outcome.AWAY_WIN;
                }

                // Calculate confidence (entropy-based)
                const probs = [finalHome, finalDraw, finalAway];
                const entropy = -probs.reduce((sum, p) => sum + p * Math.log(p + 1e-10), 0);
                const maxEntropy = Math.log(3);
                const confidence = 1 - (entropy / maxEntropy);

                // Advanced analysis calculations
                const h = marketPred.homeWin - poissonPred.homeWin;
                const a = marketPred.awayWin - poissonPred.awayWin;
                const hh = compositePred.homeWin - poissonPred.homeWin;
                const aa = compositePred.awayWin - poissonPred.awayWin;
                const h_h = formPred.homeWin - defensePred.homeWin;
                const a_a = formPred.awayWin - defensePred.awayWin;
                const d_d = defensePred.draw - marketPred.draw;
                const hh_hh = formPred.homeWin - marketPred.homeWin;
                const aa_aa = formPred.awayWin - marketPred.awayWin;
                const ho = marketPred.homeWin - compositePred.homeWin;
                const aw = marketPred.awayWin - compositePred.awayWin;
                const hom_s = compositePred.homeWin - defensePred.homeWin;
                const awa_s = compositePred.awayWin - defensePred.awayWin;

                const diff = formPred.draw > defensePred.draw;
                const diffn = compositePred.draw < formPred.draw;
                const betting = compositePred.draw < marketPred.draw;

                const hbet = (hom_s > awa_s && formPred.homeWin < formPred.awayWin) || 
                           (defensePred.homeWin > defensePred.awayWin && poissonPred.homeWin > poissonPred.awayWin);
                const abet = (hom_s < awa_s && formPred.homeWin > formPred.awayWin) || 
                           (defensePred.homeWin < defensePred.awayWin && poissonPred.homeWin < poissonPred.awayWin);

                return {
                    predictedOutcome,
                    probabilities: {
                        homeWin: Math.round(finalHome * 10000) / 10000,
                        draw: Math.round(finalDraw * 10000) / 10000,
                        awayWin: Math.round(finalAway * 10000) / 10000
                    },
                    confidence: Math.round(confidence * 10000) / 10000,
                    expectedGoals: poissonPred.expectedGoals,
                    modelBreakdown: {
                        poisson: {
                            homeWin: Math.round(poissonPred.homeWin * 10000) / 10000,
                            draw: Math.round(poissonPred.draw * 10000) / 10000,
                            awayWin: Math.round(poissonPred.awayWin * 10000) / 10000
                        },
                        formBased: {
                            homeWin: Math.round(formPred.homeWin * 10000) / 10000,
                            draw: Math.round(formPred.draw * 10000) / 10000,
                            awayWin: Math.round(formPred.awayWin * 10000) / 10000
                        },
                        defensiveStrength: {
                            homeWin: Math.round(defensePred.homeWin * 10000) / 10000,
                            draw: Math.round(defensePred.draw * 10000) / 10000,
                            awayWin: Math.round(defensePred.awayWin * 10000) / 10000
                        },
                        marketSentiment: {
                            homeWin: Math.round(marketPred.homeWin * 10000) / 10000,
                            draw: Math.round(marketPred.draw * 10000) / 10000,
                            awayWin: Math.round(marketPred.awayWin * 10000) / 10000
                        },
                        compositeRating: {
                            homeWin: Math.round(compositePred.homeWin * 10000) / 10000,
                            draw: Math.round(compositePred.draw * 10000) / 10000,
                            awayWin: Math.round(compositePred.awayWin * 10000) / 10000
                        }
                    },
                    teamQualityScores: {
                        home: Math.round(compositePred.homeQuality * 10000) / 10000,
                        away: Math.round(compositePred.awayQuality * 10000) / 10000
                    },
                    advancedAnalysis: {
                        h, a, hh, aa, h_h, a_a, d_d, hh_hh, aa_aa, ho, aw, hom_s, awa_s,
                        diff, diffn, betting, hbet, abet
                    }
                };
            }
        }

        // UI Functions
        function formatPercentage(value) {
            return `${Math.round(value * 100)}%`;
        }

        function formatDecimal(value, decimals = 2) {
            return value.toFixed(decimals);
        }

        function getAdvice(prediction) {
            const finalProbs = prediction.probabilities;
            const compositeProbs = prediction.modelBreakdown.compositeRating;
            const formPreds = prediction.modelBreakdown.formBased;
            const defensePreds = prediction.modelBreakdown.defensiveStrength;
            const analysis = prediction.advancedAnalysis;

            const aaDiff = formPreds.awayWin - finalProbs.awayWin;
            const hhDiff = formPreds.homeWin - finalProbs.homeWin;
            const ddDiff = formPreds.draw - finalProbs.draw;
            const dDiff = finalProbs.draw - compositeProbs.draw;
            const aDiff = finalProbs.awayWin - compositeProbs.awayWin;
            const hDiff = finalProbs.homeWin - compositeProbs.homeWin;

            const tHgames = (dDiff + ddDiff) > ddDiff;
            const tAgames = (dDiff + ddDiff) > ddDiff;
            const hAdv = compositeProbs.homeWin / defensePreds.awayWin;
            const aAdv = compositeProbs.awayWin / defensePreds.homeWin;
            const hAdvPer = Math.round((hAdv - aAdv) * 100 * 10) / 10;
            const aAdvPer = Math.round((aAdv - hAdv) * 100 * 10) / 10;

            // Complex condition checking (simplified from original Python logic)
            if (aaDiff > ((aDiff - aaDiff) - (hDiff - aaDiff)) && tHgames && 
                (dDiff) > (ddDiff) && hDiff > hhDiff && aDiff < aaDiff && 
                hhDiff < ((hDiff - hhDiff) - (aDiff - hhDiff)) && 
                hDiff > dDiff && hDiff >= aaDiff && analysis.h_h > analysis.a_a) {
                return `üéØ HOME SUPER WIN - ${hAdvPer}%`;
            } else if (aaDiff > ((aDiff - aaDiff) - (hDiff - aaDiff)) && tHgames && 
                      (dDiff) > (ddDiff) && hDiff > ddDiff && hDiff > hhDiff && 
                      hhDiff < ((hDiff - hhDiff) - (aDiff - hhDiff)) && 
                      hDiff > dDiff && hDiff >= aaDiff) {
                return `üéØ HOME SUPER DRAW - ${hAdvPer}%`;
            } else if (hhDiff > ((hDiff - hhDiff) - (aDiff - hhDiff)) && tAgames && 
                      (dDiff) > (ddDiff) && aDiff > aaDiff && hDiff < hhDiff && 
                      aaDiff < ((aDiff - aaDiff) - (hDiff - aaDiff)) && 
                      aDiff > dDiff && aDiff >= hhDiff && analysis.h_h < analysis.a_a) {
                return `üéØ AWAY SUPER WIN - ${aAdvPer}%`;
            } else if (hhDiff > ((hDiff - hhDiff) - (aDiff - hhDiff)) && tAgames && 
                      (dDiff) > (ddDiff) && aDiff > ddDiff && aDiff > aaDiff && 
                      aaDiff < ((aDiff - aaDiff) - (hDiff - aaDiff)) && 
                      aDiff > dDiff && aDiff >= hhDiff) {
                return `üéØ AWAY SUPER DRAW - ${aAdvPer}%`;
            } else if ((dDiff) < (ddDiff) && compositeProbs.homeWin > compositeProbs.draw && 
                      hhDiff < ((hDiff - hhDiff) - (aDiff - hhDiff)) && 
                      hhDiff < ddDiff && hDiff > hhDiff && aDiff < aaDiff && analysis.h_h > analysis.a_a) {
                return `‚ö†Ô∏è Check H-D-B - ${hAdvPer}%`;
            } else if ((dDiff) < (ddDiff) && compositeProbs.awayWin > compositeProbs.draw && 
                      aaDiff < ((aDiff - aaDiff) - (hDiff - aaDiff)) && 
                      aaDiff < ddDiff && hDiff < hhDiff && aDiff > aaDiff && analysis.h_h < analysis.a_a) {
                return `‚ö†Ô∏è Check A-D-B - ${aAdvPer}%`;
            } else {
                return '‚ö†Ô∏è BE CAREFUL üß† - Complex analysis required';
            }
        }

        function displayResults(prediction) {
            const resultsDiv = document.getElementById('results');
            const outcomeCard = document.getElementById('outcomeCard');
            const outcomeText = document.getElementById('outcomeText');
            const confidenceText = document.getElementById('confidenceText');

            // Set outcome card styling and text
            outcomeCard.className = 'outcome-card';
            if (prediction.predictedOutcome === Outcome.HOME_WIN) {
                outcomeCard.classList.add('outcome-home');
            } else if (prediction.predictedOutcome === Outcome.DRAW) {
                outcomeCard.classList.add('outcome-draw');
            } else {
                outcomeCard.classList.add('outcome-away');
            }

            outcomeText.textContent = `üèÜ Predicted: ${prediction.predictedOutcome}`;
            confidenceText.textContent = `üìä Confidence: ${formatPercentage(prediction.confidence)}`;

            // Update probabilities
            document.getElementById('homeWinProb').textContent = formatPercentage(prediction.probabilities.homeWin);
            document.getElementById('drawProb').textContent = formatPercentage(prediction.probabilities.draw);
            document.getElementById('awayWinProb').textContent = formatPercentage(prediction.probabilities.awayWin);

            // Update expected goals
            document.getElementById('homeExpectedGoals').textContent = formatDecimal(prediction.expectedGoals.home);
            document.getElementById('awayExpectedGoals').textContent = formatDecimal(prediction.expectedGoals.away);

            // Update quality scores
            document.getElementById('homeQuality').textContent = formatDecimal(prediction.teamQualityScores.home, 3);
            document.getElementById('awayQuality').textContent = formatDecimal(prediction.teamQualityScores.away, 3);

            // Update model breakdown
            const modelBreakdown = document.getElementById('modelBreakdown');
            modelBreakdown.innerHTML = '';

            const modelNames = {
                poisson: 'Poisson Distribution',
                formBased: 'Form Based',
                defensiveStrength: 'Defensive Strength',
                marketSentiment: 'Market Sentiment',
                compositeRating: 'Composite Rating'
            };

            for (const [modelKey, modelData] of Object.entries(prediction.modelBreakdown)) {
                const modelDiv = document.createElement('div');
                modelDiv.className = 'model-item';
                
                modelDiv.innerHTML = `
                    <h5>${modelNames[modelKey]}</h5>
                    <div class="model-probs">
                        <span>H: ${formatPercentage(modelData.homeWin)}</span>
                        <span>D: ${formatPercentage(modelData.draw)}</span>
                        <span>A: ${formatPercentage(modelData.awayWin)}</span>
                    </div>
                `;
                
                modelBreakdown.appendChild(modelDiv);
            }

            // Update comparison table
            const comparisonTable = document.getElementById('comparisonTable');
            const finalProbs = prediction.probabilities;
            const compositeProbs = prediction.modelBreakdown.compositeRating;

            comparisonTable.innerHTML = `
                <tr>
                    <td>Home Win</td>
                    <td>${formatPercentage(finalProbs.homeWin)}</td>
                    <td>${formatPercentage(compositeProbs.homeWin)}</td>
                    <td>${(finalProbs.homeWin - compositeProbs.homeWin >= 0 ? '+' : '') + formatPercentage(finalProbs.homeWin - compositeProbs.homeWin)}</td>
                </tr>
                <tr>
                    <td>Draw</td>
                    <td>${formatPercentage(finalProbs.draw)}</td>
                    <td>${formatPercentage(compositeProbs.draw)}</td>
                    <td>${(finalProbs.draw - compositeProbs.draw >= 0 ? '+' : '') + formatPercentage(finalProbs.draw - compositeProbs.draw)}</td>
                </tr>
                <tr>
                    <td>Away Win</td>
                    <td>${formatPercentage(finalProbs.awayWin)}</td>
                    <td>${formatPercentage(compositeProbs.awayWin)}</td>
                    <td>${(finalProbs.awayWin - compositeProbs.awayWin >= 0 ? '+' : '') + formatPercentage(finalProbs.awayWin - compositeProbs.awayWin)}</td>
                </tr>
            `;

            // Update advice section
            const adviceSection = document.getElementById('adviceSection');
            adviceSection.textContent = getAdvice(prediction);

            // Show results
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // Event Listeners
        document.getElementById('matchForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';

            // Get form data
            const formData = new FormData(e.target);
            const matchData = new MatchData({
                homeAvgScore: parseFloat(formData.get('homeAvgScore') || document.getElementById('homeAvgScore').value),
                awayAvgScore: parseFloat(formData.get('awayAvgScore') || document.getElementById('awayAvgScore').value),
                homeAvgConceded: parseFloat(formData.get('homeAvgConceded') || document.getElementById('homeAvgConceded').value),
                awayAvgConceded: parseFloat(formData.get('awayAvgConceded') || document.getElementById('awayAvgConceded').value),
                homeScorePercentage: parseFloat(formData.get('homeScorePercentage') || document.getElementById('homeScorePercentage').value),
                awayScorePercentage: parseFloat(formData.get('awayScorePercentage') || document.getElementById('awayScorePercentage').value),
                homeCleansheet: parseFloat(formData.get('homeCleansheet') || document.getElementById('homeCleansheet').value),
                awayCleansheet: parseFloat(formData.get('awayCleansheet') || document.getElementById('awayCleansheet').value),
                homeDifficulty: parseInt(formData.get('homeDifficulty') || document.getElementById('homeDifficulty').value),
                awayDifficulty: parseInt(formData.get('awayDifficulty') || document.getElementById('awayDifficulty').value),
                homeOdds: parseFloat(formData.get('homeOdds') || document.getElementById('homeOdds').value),
                drawOdds: parseFloat(formData.get('drawOdds') || document.getElementById('drawOdds').value),
                awayOdds: parseFloat(formData.get('awayOdds') || document.getElementById('awayOdds').value)
            });

            // Simulate processing time
            setTimeout(() => {
                const predictor = new FootballPredictor();
                const prediction = predictor.predictMatch(matchData);

                // Hide loading
                document.getElementById('loading').style.display = 'none';

                // Display results
                displayResults(prediction);
            }, 1500);
        });

        // Add some sample data presets
        function loadSampleData(preset) {
            const presets = {
                balanced: {
                    homeAvgScore: 1.5, homeAvgConceded: 1.2, homeScorePercentage: 60, homeCleansheet: 30, homeDifficulty: 3, homeOdds: 2.5,
                    awayAvgScore: 1.4, awayAvgConceded: 1.3, awayScorePercentage: 55, awayCleansheet: 25, awayDifficulty: 3, awayOdds: 2.8,
                    drawOdds: 3.2
                },
                homeAdvantage: {
                    homeAvgScore: 2.1, homeAvgConceded: 0.8, homeScorePercentage: 75, homeCleansheet: 45, homeDifficulty: 2, homeOdds: 1.8,
                    awayAvgScore: 1.0, awayAvgConceded: 1.8, awayScorePercentage: 40, awayCleansheet: 15, awayDifficulty: 4, awayOdds: 4.5,
                    drawOdds: 3.8
                },
                awayAdvantage: {
                    homeAvgScore: 1.0, homeAvgConceded: 1.8, homeScorePercentage: 40, homeCleansheet: 15, homeDifficulty: 4, homeOdds: 4.5,
                    awayAvgScore: 2.1, awayAvgConceded: 0.8, awayScorePercentage: 75, awayCleansheet: 45, awayDifficulty: 2, awayOdds: 1.8,
                    drawOdds: 3.8
                }
            };

            if (presets[preset]) {
                const data = presets[preset];
                Object.keys(data).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = data[key];
                    }
                });
            }
        }

        // Add preset buttons to the interface
        window.addEventListener('DOMContentLoaded', function() {
            const formSection = document.querySelector('.form-section:last-of-type');
            const presetDiv = document.createElement('div');
            presetDiv.innerHTML = `
                <h3 style="color: #2a5298; margin-bottom: 15px;">üé≤ Quick Presets</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                    <button type="button" onclick="loadSampleData('balanced')" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">Balanced Match</button>
                    <button type="button" onclick="loadSampleData('homeAdvantage')" style="padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Home Advantage</button>
                    <button type="button" onclick="loadSampleData('awayAdvantage')" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">Away Advantage</button>
                </div>
            `;
            formSection.appendChild(presetDiv);
        });
    </script>
</body>
</html>
